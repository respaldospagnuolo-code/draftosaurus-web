<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Draftosaurus</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #2d2d2d;
            color: white;
            padding: 20px;
        }
        .debug-section {
            background: #1a1a1a;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border: 1px solid #444;
        }
        .error { background: #4a1a1a; border-color: #ff6b6b; }
        .success { background: #1a4a1a; border-color: #51cf66; }
        .warning { background: #4a4a1a; border-color: #ffd43b; }
        button {
            background: #628107;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #5a7305; }
        .log-output {
            background: #000;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>ü¶ï Debug Draftosaurus - Loader Issue</h1>
    
    <div class="debug-section">
        <h2>1. Verificar Archivos Principales</h2>
        <button onclick="checkFiles()">Verificar Archivos</button>
        <div id="file-check"></div>
    </div>

    <div class="debug-section">
        <h2>2. Test Conexi√≥n Base de Datos</h2>
        <button onclick="testDatabase()">Test BD</button>
        <div id="db-test"></div>
    </div>

    <div class="debug-section">
        <h2>3. Verificar APIs</h2>
        <button onclick="testAPIs()">Test APIs</button>
        <div id="api-test"></div>
    </div>

    <div class="debug-section">
        <h2>4. Debug JavaScript</h2>
        <button onclick="testJS()">Test JavaScript</button>
        <div id="js-test"></div>
    </div>

    <div class="debug-section">
        <h2>5. Simular Inicio de App</h2>
        <button onclick="simulateAppStart()">Simular Inicio</button>
        <div id="app-simulation"></div>
    </div>

    <div class="debug-section">
        <h2>6. Console Logs</h2>
        <div id="console-logs" class="log-output"></div>
    </div>

    <script>
        // Capturar logs de consola
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        function addToConsoleLog(type, message) {
            const timestamp = new Date().toLocaleTimeString();
            const logElement = document.getElementById('console-logs');
            logElement.innerHTML += `[${timestamp}] ${type.toUpperCase()}: ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
        }
        
        console.log = function(...args) {
            addToConsoleLog('log', args.join(' '));
            originalLog.apply(console, args);
        };
        
        console.error = function(...args) {
            addToConsoleLog('error', args.join(' '));
            originalError.apply(console, args);
        };
        
        console.warn = function(...args) {
            addToConsoleLog('warn', args.join(' '));
            originalWarn.apply(console, args);
        };

        // 1. Verificar archivos
        async function checkFiles() {
            const output = document.getElementById('file-check');
            output.innerHTML = '<p>üîç Verificando archivos...</p>';
            
            const files = [
                'index.html',
                'app.js',
                'estilos.css',
                'tablero.css',
                'config.php',
                'login.php',
                'register.php'
            ];
            
            let results = [];
            
            for (const file of files) {
                try {
                    const response = await fetch(file, { method: 'HEAD' });
                    const status = response.ok ? '‚úÖ' : '‚ùå';
                    results.push(`${status} ${file} (${response.status})`);
                } catch (error) {
                    results.push(`‚ùå ${file} (Error: ${error.message})`);
                }
            }
            
            output.innerHTML = `<div class="log-output">${results.join('\n')}</div>`;
        }

        // 2. Test base de datos
        async function testDatabase() {
            const output = document.getElementById('db-test');
            output.innerHTML = '<p>üîç Probando conexi√≥n BD...</p>';
            
            try {
                const response = await fetch('test.php');
                const text = await response.text();
                
                if (response.ok) {
                    output.innerHTML = `<div class="success">‚úÖ Conexi√≥n BD exitosa</div><div class="log-output">${text}</div>`;
                } else {
                    output.innerHTML = `<div class="error">‚ùå Error BD (${response.status})</div><div class="log-output">${text}</div>`;
                }
            } catch (error) {
                output.innerHTML = `<div class="error">‚ùå Error de conexi√≥n: ${error.message}</div>`;
            }
        }

        // 3. Test APIs
        async function testAPIs() {
            const output = document.getElementById('api-test');
            output.innerHTML = '<p>üîç Probando APIs...</p>';
            
            const apis = [
                { name: 'Config', url: 'config.php' },
                { name: 'Login', url: 'login.php', method: 'POST' },
                { name: 'Register', url: 'register.php', method: 'POST' }
            ];
            
            let results = [];
            
            for (const api of apis) {
                try {
                    const options = {
                        method: api.method || 'GET',
                        headers: { 'Content-Type': 'application/json' }
                    };
                    
                    if (api.method === 'POST') {
                        options.body = JSON.stringify({ test: true });
                    }
                    
                    const response = await fetch(api.url, options);
                    const text = await response.text();
                    
                    let status = '‚úÖ';
                    if (response.status >= 400 && response.status !== 400) {
                        status = '‚ùå';
                    } else if (response.status === 400 && api.method === 'POST') {
                        status = '‚ö†Ô∏è'; // 400 es esperado para POST sin datos v√°lidos
                    }
                    
                    results.push(`${status} ${api.name} (${response.status})`);
                } catch (error) {
                    results.push(`‚ùå ${api.name} (Error: ${error.message})`);
                }
            }
            
            output.innerHTML = `<div class="log-output">${results.join('\n')}</div>`;
        }

        // 4. Test JavaScript
        function testJS() {
            const output = document.getElementById('js-test');
            output.innerHTML = '<p>üîç Probando JavaScript...</p>';
            
            let results = [];
            
            // Verificar variables globales
            results.push(typeof window !== 'undefined' ? '‚úÖ window disponible' : '‚ùå window no disponible');
            results.push(typeof document !== 'undefined' ? '‚úÖ document disponible' : '‚ùå document no disponible');
            results.push(typeof fetch !== 'undefined' ? '‚úÖ fetch disponible' : '‚ùå fetch no disponible');
            
            // Verificar localStorage
            try {
                localStorage.setItem('test', 'test');
                localStorage.removeItem('test');
                results.push('‚úÖ localStorage funcional');
            } catch (error) {
                results.push(`‚ùå localStorage error: ${error.message}`);
            }
            
            // Verificar JSON
            try {
                JSON.parse('{"test": true}');
                results.push('‚úÖ JSON funcional');
            } catch (error) {
                results.push(`‚ùå JSON error: ${error.message}`);
            }
            
            // Verificar Promises
            try {
                new Promise(resolve => resolve(true));
                results.push('‚úÖ Promises disponibles');
            } catch (error) {
                results.push(`‚ùå Promises error: ${error.message}`);
            }
            
            output.innerHTML = `<div class="log-output">${results.join('\n')}</div>`;
        }

        // 5. Simular inicio de app
        async function simulateAppStart() {
            const output = document.getElementById('app-simulation');
            output.innerHTML = '<p>üîç Simulando inicio de app...</p>';
            
            let steps = [];
            
            try {
                // Paso 1: DOMContentLoaded
                steps.push('‚úÖ Simulando DOMContentLoaded');
                
                // Paso 2: Crear instancia AppState
                steps.push('‚úÖ Creando instancia AppState (simulado)');
                
                // Paso 3: Verificar sesi√≥n existente
                steps.push('üîç Verificando sesi√≥n existente...');
                try {
                    const response = await fetch('verify-session.php');
                    if (response.ok) {
                        steps.push('‚úÖ verify-session.php responde');
                    } else {
                        steps.push(`‚ö†Ô∏è verify-session.php status: ${response.status}`);
                    }
                } catch (error) {
                    steps.push(`‚ùå verify-session.php error: ${error.message}`);
                }
                
                // Paso 4: Cargar configuraci√≥n
                steps.push('üîç Cargando configuraci√≥n...');
                try {
                    const response = await fetch('config.php');
                    if (response.ok) {
                        steps.push('‚úÖ config.php cargado');
                    } else {
                        steps.push(`‚ùå config.php error: ${response.status}`);
                    }
                } catch (error) {
                    steps.push(`‚ùå config.php error: ${error.message}`);
                }
                
                // Paso 5: Mostrar pantalla login
                steps.push('‚úÖ Deber√≠a mostrar pantalla login');
                
            } catch (error) {
                steps.push(`‚ùå Error general: ${error.message}`);
            }
            
            output.innerHTML = `<div class="log-output">${steps.join('\n')}</div>`;
        }

        // Auto-ejecutar algunos tests al cargar
        window.addEventListener('load', () => {
            console.log('ü¶ï Debug page loaded');
            setTimeout(() => {
                checkFiles();
            }, 1000);
        });
    </script>
</body>
</html>